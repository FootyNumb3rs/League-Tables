<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
        <title>Premier League Interactive</title>
        <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
        <script type="text/javascript" src="/match_data.json"></script>
        <script type="text/javascript" src="/league_table.json"></script>
        <script type="text/javascript" src="/team_data2.json"></script>
         <script src="https://requirejs.org/docs/release/2.3.5/minified/require.js" type="text/javascript"></script>
        <link href="https://fonts.googleapis.com/css?family=Abel|Alegreya+Sans+SC|Barlow+Semi+Condensed:100,200|Encode+Sans+Condensed:100|Exo+2|Heebo:300,400|Lekton|Montserrat:200,300|News+Cycle|Open+Sans|Rajdhani:300|Roboto+Mono:300|Source+Sans+Pro:300|Varela+Round|Yantramanav:300|Raleway:800|Libre+Franklin|Questrial|Archivo" rel="stylesheet">

        </style>
</head>
<body>
    <script type="text/javascript">

      debugger;

      var svg = d3.select('body').append('svg').attr('height',1000).attr('width',1000)
      var teamFont = 'Libre Franklin'
      var numFont = 'Arial'
      var winColor = '#009246'
      var drawColor = 'grey'
      var lossColor = '#ff0000'


      // Margin 
      var pos_margin = 10
      var crest_margin = pos_margin +10
      var name_margin = crest_margin + 20
      var stats_margin = name_margin + 160
      var projected_margin = stats_margin + 80
      var dots_margin = projected_margin+130

      var scales = {}

      function createScale(data,c1,c2,c3){
        return(
           d3.scaleLinear()
            .domain([Math.min(...data),(Math.min(...data)+Math.max(...data))/2,Math.max(...data)])
            .interpolate(d3.interpolateLab)
            .range([c1,c2,c3])
          )}
      


      scales['points'] = createScale(league_table.map(k=>k['points']),lossColor,drawColor,winColor)
      scales['won'] = createScale(league_table.map(k=>k['won']),lossColor,drawColor,winColor)
      scales['lost'] = createScale(league_table.map(k=>k['lost']),winColor,drawColor,lossColor)
      scales['draw'] = createScale(league_table.map(k=>k['draw']),'#f2f2f2',drawColor,drawColor)


       svg.append('rect')
         .attr('height',1000)
         .attr('width',1000)
         .attr('fill',' #f2f2f2')   

      league_table.forEach(function(d,i){
        var g = svg.append('g').attr('transform','translate(30,'+String(i*30+75)+')')
    
        // Team Position
         g.append('text')
         .text(i+1)
         .attr('x',pos_margin)
         .attr('y',0)
         .attr('font-family',numFont)
         .attr('font-size',14)
         .attr('fill','grey')
         .attr('text-anchor','end') 

         // CREST 
         g.append("svg:image")
        .attr('x', crest_margin)
        .attr('y', function(){
          if (d.team == 'Tottenham Hotspur FC'){return -15}
          else{return(-12)}
          })
        .attr('width', function(){
          if (d.team == 'Tottenham Hotspur FC'){return 10}
          else{return(15)}
          })
        .attr("xlink:href",team_data.filter(k=>k.name==d.team)[0]['crestUrl'])
        


        // Team Name
        g.append('text')
         .text(function(){
          return team_data.filter(k=>k.name == d.team)[0]['shortName'].toUpperCase()}
          )
         .attr('x',name_margin)
         .attr('y',0)
         .attr('font-family',teamFont)
         .attr('font-weight','bold')
         .attr('fill','black')
         .attr('font-size',14)

        // Points, Won, Lost, Draw
        g.append('g')
          .selectAll('text')
           .data(['points','won','lost','draw'])
         .enter()
         .append('text')
         .text(function(d_){return d[d_]})
         .attr('x',function(d_,i_){
          return(stats_margin+i_*22)
         })
         .attr('y',0)
         .attr('font-family',numFont)
         .attr('font-size',13)
        .attr('fill',function(d_)
          {if(d_=='draw'){return'grey'}
            else{
            return(scales[d_](d[d_]))}}
          )
         .attr('text-anchor','end')
         .attr('opacity',1)




         // Squares
         g.append('g')
          .selectAll('circle')
         .data(['points','won','lost','draw'])
         .enter()
         .append('circle')
         .attr('r',10)
         .attr('cx',function(d_,i_){
          if (d[d_]>=10){
          return(stats_margin+i_*22-6.5)}
          else {return(stats_margin+i_*22-4)}
         })
         .attr('cy',-4.5)
         .attr('fill',function(d_){return(scales[d_](d[d_]))})
         .attr('opacity',.15)
         
         


        // Game Circles
        g.append('g')
        .selectAll('circle')
         .data( match_data.filter(k=>(k.homeTeam==d.team) | (k.awayTeam == d.team)))
         .enter()
         .append('circle')
         .attr('r',6.5)
         .attr('cx',function(k,j){
          console.log(j)
          return dots_margin  + j*30})
         .attr('cy',-4.5)
         .attr('fill',function(k){
          var winningSide =  k['winner'].slice(0,4).toLowerCase()
          var winningTeam = k[winningSide+'Team']
          console.log(winningTeam)
          if (k['winner']=='DRAW'){return drawColor}
          else if(winningTeam==d.team) {return winColor}
          else{return lossColor}
         })
         .attr('opacity',.8)
         .attr('stroke-width',0)
         .attr('stroke','gray')
         .attr('opacity',.5)

         // Projected Points Slider
         /*
          g.append('rect')
         .attr('height',.3)
         .attr('width',110)
         .attr('fill','gray')
         .attr('y',-5)
         .attr('x',220)
         */

          // Projected Points
          g.append('rect')
         .attr('height',1.1)
         .attr('width',(38-d.playedGames)*(d.points/d.playedGames))
         .attr('fill','silver')
         .attr('y',-5.7)
         .attr('x',projected_margin)
         g.append('circle')
         .attr('r',3)
         .attr('fill','silver')
         .attr('cy',-4.7)
         .attr('cx',projected_margin+(38-d.playedGames)*(d.points/d.playedGames))

         // Current Points
          g.append('rect')
         .attr('height',2)
         .attr('width',d.points)
         .attr('fill',scales['points'](d.points))
         .attr('y',-5.7)
         .attr('x',projected_margin)
         g.append('circle')
         .attr('r',4)
         .attr('fill',scales['points'](d.points))
         .attr('cy',-4.7)
         .attr('cx',projected_margin+d.points)

        
         // Underline
          g.append('rect')
         .attr('height',.7)
         .attr('width',600)
         .attr('fill','gray')
         .attr('y',10)


      })





    </script>
</body>
</html>
